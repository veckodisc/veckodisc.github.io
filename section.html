<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<link rel="stylesheet" href="css/section.css">
		<title>The Second Brain</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/particlesjs/2.2.2/particles.min.js"></script>
	</head>
    <body>
    	<h1 id='title'></h1>
		<p id='intro' class="intro"></p>
      	
      	<!--<form action="/" method="post">
 			<fieldset>
       		<legend>Sample Form</legend>
       	       First name:<br>        
       	       <textarea cols="40" rows="5" type="text" name="firstname" ></textarea>
       	       <br>
       	       Last name:<br>
       	       <textarea cols="40" rows="5" type="text" name="lastname" ></textarea>
      	       <br><br>         
      	       <input type="submit" value="Submit">        
			</fieldset>
 	   	</form>-->
 	   	
 	   	
		<div id='articles'></div>
		
		<canvas class="background"></canvas>
		
		<script>
      		let cubes = JSON.parse(localStorage.getItem("cubes"));
		    let cube = null;
		    for (let i = 0; i < cubes.length; i++) {
		    	if(cubes[i].id == localStorage.getItem("current_cube")) {
		    		cube = cubes[i];
		    	}
		    }
		    let section = null;
		    for (let i = 0; i < cube.sections.length; i++) {
		    	if(cube.sections[i].id == localStorage.getItem("current_section")) {
		    		section = cube.sections[i];
		    	}
		    }
		    document.getElementById('title').innerHTML = section.title;
		    document.getElementById('intro').innerHTML = section.intro;
		    
		    let html = document.getElementById('articles').innerHTML;
		    for (let i = 0; i < section.articles.length; i++) {
		    	html += "<h2>" + section.articles[i].title + "</h2><div class='tab'>";
		    	let tabs_list = "";
		    	for (let j = 0; j < section.articles[i].tabs.length; j++) {
		    		tabs_list += "'" + section.articles[i].tabs[j].id + "'";
		    		if(j < section.articles[i].tabs.length - 1) {
		    			tabs_list += ", ";
		    		}
		    	}
		    	for (let j = 0; j < section.articles[i].tabs.length; j++) {
		    		s = 'onclick="';
		    		s += "openTab(event, '" + section.articles[i].tabs[j].id + "', '" + section.articles[i].id + "', [" + tabs_list + "])";
		    		s += '"';
		    		html += "<button class='" + section.articles[i].id + "' " + s + ">" + section.articles[i].tabs[j].title + "</button>";
		    	}
		    	html += "</div>";
		    	for (let j = 0; j < section.articles[i].tabs.length; j++) {
		    		html += "<div id='" + section.articles[i].tabs[j].id + "' class='tabcontent'><h3>" + section.articles[i].tabs[j].title + "</h3><p>" + section.articles[i].tabs[j].text + "</p></div>";
		    	}
		    }
		    console.log(html);
		    document.getElementById('articles').innerHTML = html;
			
			
			for (let i = 0; i < section.articles.length; i++) {
				document.getElementsByClassName(section.articles[i].id)[0].click();
			}
			
			let num_particles = window.innerHeight * window.innerWidth / 5000;
			window.onload = function() {
			  Particles.init({
			    selector: '.background',
			    maxParticles: num_particles.toFixed(0),
		        color: '#777777',
		        connectParticles: true,
		        speed: 0,
			  });
			};
			
			function openTab(evt, tabId, buttonId, tabs) {
			  var i, tablinks;
			  
			  for (i = 0; i < tabs.length; i++) {
				document.getElementById(tabs[i]).style.display = "none";
			  }
			  tablinks = document.getElementsByClassName(buttonId);
			  for (i = 0; i < tablinks.length; i++) {
				tablinks[i].className = tablinks[i].className.replace(" active", "");
			  }
			  document.getElementById(tabId).style.display = "block";
			  evt.currentTarget.className += " active";
			}
		</script>
    </body>
</html>
